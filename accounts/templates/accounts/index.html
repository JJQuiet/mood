{% extends 'base.html' %}
{% load static %}
{% block head_title %}主页{% endblock %}
{% block css %}
<link rel="stylesheet" href="{% static 'css/index.css' %}">
{% endblock %}
{% block content %}
<div class="guide-section">
    <ul>
        <li><a href="javascript:void(0);" class="">
            <svg t="1617351964328" class="icon" viewBox="0 0 1024 1024" version="1.1"
                 xmlns="http://www.w3.org/2000/svg" p-id="7136" width="32" height="32">
                <path d="M386.681905 294.521905c53.638095 0 97.52381 43.885714 97.523809 97.523809v341.333334c0 53.638095-43.885714 97.52381-97.523809 97.523809s-97.52381-43.885714-97.52381-97.523809v-341.333334c0-53.638095 43.885714-97.52381 97.52381-97.523809z"
                      fill="#FFCD00" p-id="7137"></path>
                <path d="M694.857143 405.699048h-170.666667c-6.826667 0-12.190476-5.36381-12.190476-12.190477s5.36381-12.190476 12.190476-12.190476h170.666667c6.826667 0 12.190476 5.36381 12.190476 12.190476s-5.36381 12.190476-12.190476 12.190477zM376.685714 437.150476c-2.925714 0-5.851429-0.975238-8.289524-3.169524l-45.348571-41.935238c-4.87619-4.632381-5.36381-12.190476-0.731429-17.310476s12.190476-5.12 17.310477-0.731428l37.059047 34.377142 59.733334-55.344762c4.87619-4.632381 12.678095-4.388571 17.310476 0.731429 4.632381 4.87619 4.388571 12.678095-0.731429 17.310476l-68.022857 62.902857c-2.438095 1.950476-5.36381 3.169524-8.289524 3.169524zM694.857143 576.365714h-170.666667c-6.826667 0-12.190476-5.36381-12.190476-12.190476s5.36381-12.190476 12.190476-12.190476h170.666667c6.826667 0 12.190476 5.36381 12.190476 12.190476s-5.36381 12.190476-12.190476 12.190476zM376.685714 605.379048c-2.925714 0-5.851429-0.975238-8.289524-3.169524l-45.348571-41.935238c-4.87619-4.632381-5.36381-12.190476-0.731429-17.310476s12.190476-5.12 17.310477-0.731429l37.059047 34.377143 59.733334-55.344762c4.87619-4.632381 12.678095-4.388571 17.310476 0.731428 4.632381 4.87619 4.388571 12.678095-0.731429 17.310477l-68.022857 62.902857c-2.438095 2.194286-5.36381 3.169524-8.289524 3.169524zM694.857143 747.032381h-170.666667c-6.826667 0-12.190476-5.36381-12.190476-12.190476s5.36381-12.190476 12.190476-12.190476h170.666667c6.826667 0 12.190476 5.36381 12.190476 12.190476s-5.36381 12.190476-12.190476 12.190476zM388.144762 795.794286a60.952381 60.952381 0 0 1 0-121.904762c33.645714 0 60.952381 27.306667 60.952381 60.952381s-27.550476 60.952381-60.952381 60.952381z m0-97.52381c-20.23619 0-36.571429 16.335238-36.571429 36.571429s16.335238 36.571429 36.571429 36.571428 36.571429-16.335238 36.571428-36.571428-16.579048-36.571429-36.571428-36.571429zM658.285714 247.710476c-6.826667 0-12.190476-5.36381-12.190476-12.190476v-146.285714c0-6.826667-5.36381-12.190476-12.190476-12.190476H390.095238c-6.826667 0-12.190476 5.36381-12.190476 12.190476v146.285714c0 6.826667-5.36381 12.190476-12.190476 12.190476s-12.190476-5.36381-12.190476-12.190476v-146.285714c0-20.23619 16.335238-36.571429 36.571428-36.571429h243.809524c20.23619 0 36.571429 16.335238 36.571428 36.571429v146.285714c0 6.826667-5.36381 12.190476-12.190476 12.190476z"
                      p-id="7138"></path>
                <path d="M585.874286 212.114286h-147.504762c-6.826667 0-12.190476-5.36381-12.190476-12.190476s5.36381-12.190476 12.190476-12.190477h147.504762c6.826667 0 12.190476 5.36381 12.190476 12.190477s-5.607619 12.190476-12.190476 12.190476z"
                      p-id="7139"></path>
                <path d="M777.99619 896.24381H246.00381c-20.23619 0-36.571429-16.335238-36.571429-36.571429V224.304762c0-20.23619 16.335238-36.571429 36.571429-36.571429H292.571429c6.826667 0 12.190476 5.36381 12.190476 12.190477s-5.36381 12.190476-12.190476 12.190476h-46.567619c-6.826667 0-12.190476 5.36381-12.190477 12.190476v635.367619c0 6.826667 5.36381 12.190476 12.190477 12.190476h531.99238c6.826667 0 12.190476-5.36381 12.190477-12.190476V224.304762c0-6.826667-5.36381-12.190476-12.190477-12.190476H731.428571c-6.826667 0-12.190476-5.36381-12.190476-12.190476s5.36381-12.190476 12.190476-12.190477h46.567619c20.23619 0 36.571429 16.335238 36.571429 36.571429v635.367619c0 20.23619-16.335238 36.571429-36.571429 36.571429z"
                      p-id="7140"></path>
                <path d="M828.952381 971.337143H195.047619a60.952381 60.952381 0 0 1-60.952381-60.952381v-731.428572A60.952381 60.952381 0 0 1 195.047619 118.00381h97.52381c6.826667 0 12.190476 5.36381 12.190476 12.190476s-5.36381 12.190476-12.190476 12.190476H195.047619c-20.23619 0-36.571429 16.335238-36.571429 36.571428v731.428572c0 20.23619 16.335238 36.571429 36.571429 36.571428h633.904762c20.23619 0 36.571429-16.335238 36.571429-36.571428v-731.428572c0-20.23619-16.335238-36.571429-36.571429-36.571428h-97.52381c-6.826667 0-12.190476-5.36381-12.190476-12.190476s5.36381-12.190476 12.190476-12.190476h97.52381a60.952381 60.952381 0 0 1 60.952381 60.95238v731.428572c0 33.401905-27.306667 60.952381-60.952381 60.952381z"
                      p-id="7141"></path>
            </svg>
            <span>工作台</span>
        </a></li>
        <li><a href="javascript:void(0);" class="">
            <svg t="1617351886553" class="icon" viewBox="0 0 1024 1024" version="1.1"
                 xmlns="http://www.w3.org/2000/svg" p-id="6217" width="32" height="32">
                <path d="M896 608a32 32 0 0 1 31.850667 28.928L928 640v96c0 115.946667-93.312 210.133333-209.450667 213.248l-5.909333 0.085333h-401.28c-116.885333 0-212.138667-92.288-215.274667-207.466666L96 736V640a32 32 0 0 1 63.850667-3.072L160 640v96c0 80.704 64.96 146.602667 146.261333 149.248l5.12 0.085333h401.258667c81.962667 0 148.586667-64.234667 151.274667-144.298666l0.085333-5.034667V640a32 32 0 0 1 32-32zM503.978667 123.370667a32 32 0 0 1 34.752-1.706667l2.624 1.706667 266.666666 192a32 32 0 0 1-34.794666 53.610666l-2.581334-1.685333L522.666667 188.757333l-247.978667 178.56a32 32 0 0 1-42.730667-4.864l-1.92-2.432a32 32 0 0 1 4.842667-42.730666l2.432-1.92 266.666667-192z"
                      fill="#8a8a8a" p-id="6218"></path>
                <path d="M522.666667 704a32 32 0 0 1-32-32v-490.666667a32 32 0 0 1 64 0v490.666667a32 32 0 0 1-32 32z"
                      fill="#8a8a8a" p-id="6219"></path>
            </svg>
            <span>文件上传</span>
        </a></li>
        <li><a href="javascript:void(0);" class="">
            <svg t="1617382557963" class="icon" viewBox="0 0 1024 1024" version="1.1"
                 xmlns="http://www.w3.org/2000/svg" p-id="2058" width="32" height="32">
                <path d="M605.333333 772.672L533.333333 830.272V533.333333a21.333333 21.333333 0 0 0-42.666666 0v296.938667l-72-57.6a21.333333 21.333333 0 0 0-26.666667 33.322667l106.666667 85.333333a21.376 21.376 0 0 0 26.666666 0l106.666667-85.333333a21.333333 21.333333 0 1 0-26.666667-33.322667z"
                      fill="#1296db" p-id="2059"></path>
                <path d="M810.666667 384c-1.130667 0-2.24 0-3.328 0.042667a298.496 298.496 0 0 0-565.418667-84.906667A213.333333 213.333333 0 0 0 256 725.333333h21.333333a21.333333 21.333333 0 0 0 0-42.666666h-21.333333a170.666667 170.666667 0 0 1 0-341.333334 21.333333 21.333333 0 0 0 19.712-13.12 255.786667 255.786667 0 0 1 491.370667 80.832 21.333333 21.333333 0 0 0 24.533333 19.626667A124.224 124.224 0 0 1 810.666667 426.666667a128 128 0 0 1 0 256h-64a21.333333 21.333333 0 0 0 0 42.666666h64a170.666667 170.666667 0 0 0 0-341.333333z"
                      fill="#1296db" p-id="2060"></path>
            </svg>
            <span>文件下载</span>
        </a></li>
        <li><a href="javascript:void(0);" class="">
            <svg t="1619861675149" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2374" width="32" height="32"><path d="M920.5248 942.08H148.61824A82.12992 82.12992 0 0 1 66.56 860.06272V108.57984a36.9152 36.9152 0 0 1 73.8304 0v751.48288a8.23808 8.23808 0 0 0 8.22784 8.22272H920.5248a36.89984 36.89984 0 1 1 0 73.79456zM230.912 643.44064a36.89984 36.89984 0 0 1-25.6-63.4624l220.3136-212.2496a36.9152 36.9152 0 0 1 51.712 0.47616l122.8288 122.77248 212.79744-207.96928a36.90496 36.90496 0 1 1 51.6096 52.76672l-238.89408 233.472a36.9152 36.9152 0 0 1-51.90144-0.29696L450.71872 445.99808 256.512 633.10336a36.77184 36.77184 0 0 1-25.6 10.33728z" fill="#595BB3" p-id="2375"></path><path d="M833.50016 489.56416l-199.3472 199.52128a22.9888 22.9888 0 0 1-31.08864-0.16384l-126.19776-119.61344a22.98368 22.98368 0 0 0-30.97088-0.27136L268.288 731.30496a20.82816 20.82816 0 0 0 15.36 36.03456H849.92a21.54496 21.54496 0 0 0 22.10816-21.03296l-0.96256-241.84832c-0.08704-18.51392-23.6032-27.83744-37.56544-14.89408z" fill="#F4CA1C" p-id="2376"></path></svg>
            <span>语句分析</span>
        </a></li>
        <li><a href="javascript:void(0);" class="">
            <svg t="1620114744658" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2933" width="32" height="32"><path d="M789.333333 512a192 192 0 0 1 192 192v42.666667a191.317333 191.317333 0 0 1-49.962666 129.194666 40.618667 40.618667 0 0 1 14.592 9.770667l45.696 45.696a42.666667 42.666667 0 0 1-60.288 60.330667l-45.738667-45.696a42.666667 42.666667 0 0 1-12.8-26.410667A190.549333 190.549333 0 0 1 789.333333 938.666667h-42.666666a192 192 0 0 1-192-192v-42.666667a192 192 0 0 1 192-192zM810.666667 0a128 128 0 0 1 127.786666 120.490667L938.666667 128v256a42.666667 42.666667 0 0 1-85.034667 4.992L853.333333 384V128a42.666667 42.666667 0 0 0-37.674666-42.368L810.666667 85.333333H128a42.666667 42.666667 0 0 0-42.368 37.674667L85.333333 128v725.333333a42.666667 42.666667 0 0 0 37.674667 42.368L128 896h298.666667a42.666667 42.666667 0 0 1 4.992 85.034667L426.666667 981.333333H128a128 128 0 0 1-127.786667-120.490666L0 853.333333V128A128 128 0 0 1 120.490667 0.213333L128 0h682.666667z m-21.333334 597.333333h-42.666666a106.666667 106.666667 0 0 0-106.666667 106.666667v42.666667a106.666667 106.666667 0 0 0 106.666667 106.666666h42.666666a106.666667 106.666667 0 0 0 106.666667-106.666666v-42.666667a106.666667 106.666667 0 0 0-106.666667-106.666667zM469.333333 512a42.666667 42.666667 0 0 1 0 85.333333H256a42.666667 42.666667 0 0 1 0-85.333333h213.333333z m213.333334-213.333333a42.666667 42.666667 0 0 1 0 85.333333H256a42.666667 42.666667 0 1 1 0-85.333333h426.666667z" fill="#008df0" p-id="2934"></path></svg>
            <span>文件分析</span>
        </a></li>
    </ul>
</div>
<div class="container1">
    <section id="workbench" class="d-none">
        <form action="" method="post" class="mb-3">{% csrf_token %}
            <select name="selectedFile">
                {% for document in documents %}
                <option value="{{ document.id }}">{{ document.file.name }}</option>
                {% endfor %}
            </select>
            <input type="submit" onclick="javascript:void(0);" name="edit" id="edit" class="btn btn-primary btn-sm" value="编辑">
        </form>
        <div class="{{ edit_alert_display }} alert alert-danger mb-1 mt-1" id="process-alert">该文件已被三人处理</div>
        <article class="p-3">
            {{ cur_edit.review }}
        </article>
        <div class="{{ process_alert_display }} alert alert-danger mb-1" id="process-alert">{{ process_alert }}</div>
        <form id="process" action="" method="POST" class="{{ process_submit_display }} ">{% csrf_token %}
            <input type="hidden" name="docitemid" value={{ cur_edit.id }}>
            <input type="submit" name="previous" class="btn btn-primary" value="上一条">
            <input type="submit" name="negative" class="btn btn-primary" value="消极的">
            <input type="submit" name="flat" class="btn btn-primary" value="中性的">
            <input type="submit" name="positive" class="btn btn-primary" value="积极的">
            <input type="submit" name="next" class="btn btn-primary" value="下一条">
        </form>
    </section>
    <section id="upload" class="d-none">
        <form class="form-inline" action='' method="post" enctype="multipart/form-data" >
            {% csrf_token %}
            <input type="file" id="docfile" name="docfile" required>
            <input type="submit" name="upload" class="btn btn-primary" value="上传">
        </form>
    </section>
    <section id="download" class="d-none" >
        <form action="" method="post">{% csrf_token %}
            <select name="selectedFile">
                {% for document in documents %}
                <option value="{{ document.id }}">{{ document.file.name }}</option>
                {% endfor %}
            </select>
            <input type="submit" name="download" class="btn btn-primary btn-sm" value="下载">
        </form>
        <input type="button" class="btn dropdown-toggle " data-toggle="dropdown">
    </section>
    <section id="sentence_analyze" class="d-none">
        <form id="form_analyze" action="" method="POST">{% csrf_token %}
            <textarea id="tobe_processed" cols="80" rows="6" placeholder="请输入待分析语句......." >这个产品很好用</textarea>
            <input type="button" id="stanfordCoreNLP_process" class="btn btn-primary btn-sm" value="综合分析">
            <input type="button" id="simple_text_sentiment" class="btn btn-primary btn-sm" value="情感值">
            <input type="button" id="simple_text_wordcloud" class="btn btn-primary btn-sm" value="词云">
        </form>
        <div id="displayProcessed" class="alert"></div>
    </section>
    <section id="csv_file_analyze" class="d-block">
        <form action="" method="post">{% csrf_token %}
            <select id="csv_file_tobe_analysed">
                {% for document in documents %}
                <option value="{{ document.id }}">{{ document.file.name }}</option>
                {% endfor %}
            </select>
            <input type="button" id="csv_file_sentiment" class="btn btn-primary btn-sm" value="情感分析">
            <input type="button" id="csvreview_file_wordcloud" class="btn btn-primary btn-sm" value="词云">
            <input type="button" id="csvreview_file_word_frequency_bar_plt" class="btn btn-primary btn-sm" value="词频统计">
        </form>
        <div id="display_csv_file_Processed" class="alert"></div>
    </section>
</div>
<script>
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
            // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    $('li').each(function(index){
        $(this).click(function(){
            $('section:nth-child(' + (index + 1) +')').attr('class', 'd-block')
            $('section:not(:nth-child(' + (index + 1) + '))').attr('class', 'd-none')
        })
    })
    $('#stanfordCoreNLP_process').click(function(){
        data = {
            // 'csrfmiddlewaretoken': Cookies.get('csrftoken'),
            // 'csrfmiddlewaretoken': $('[name=csrfmiddlewaretoken]')[0].value,
            'csrfmiddlewaretoken': getCookie('csrftoken'),
            'tobe_processed': $('#tobe_processed').val(),
            'submit': 'stanfordCoreNLP_process'
        }
        $.post('analyse', data, function(data){
            var table = '<table>'
            table += '<tr><th>word_tokenize</th><th>pos_tag</th><th>ner</th><th>dependency_parse</th></tr>'
            for(var i = 0; i < data.word_tokenize.length; i++) {
                var row = '<tr><td>' + data.word_tokenize[i] + '</td><td>' + data.pos_tag[i]+ '</td><td>' + data.ner[i]+ '</td><td>' + data.dependency_parse[i] + '</td></tr>'
                table += row
            }
            table += '</table>'
            $('#displayProcessed').append(table)
            $('#displayProcessed').append('<div id="parse">' + data.parse + '</div>')

        })
    })
    $('#simple_text_sentiment').click(function(){
        data = {
            'csrfmiddlewaretoken': getCookie('csrftoken'),
            'tobe_processed': $('#tobe_processed').val(),
            'submit': 'simple_text_sentiment'
        }
        $.post('analyse', data, function(data){
            $('#displayProcessed').html('<b>情感值: </b>' + data.sentiments )
        })
    })
    $('#csv_file_sentiment').click(function(){
        data = {
            'csrfmiddlewaretoken': getCookie('csrftoken'),
            'csv_file_tobe_analysed': $('#csv_file_tobe_analysed')[0].value,
            'submit': 'csv_file_sentiment'
        }
        $.post('analyse', data, function(data){
            var table = '<table>'
            table += '<tr><th>情感值</th><th>评价</th></tr>'
            for(var i = 0; i < data.review.length; i++) {
                var row = '<tr><td>' + data.sentiment[i] + '</td><td>' + data.review[i]+ '</td></tr>'
                table += row
            }
            table += '</table>'
            $('#display_csv_file_Processed').append(table)
        })
    })
    
    $('#simple_text_wordcloud').click(function(){
        data = {
            'csrfmiddlewaretoken': getCookie('csrftoken'),
            'simple_text_wordcloud': $('#tobe_processed')[0].value,
            'submit': 'simple_text_wordcloud'
        }
        $.post('analyse', data, function(data){
            // $('#displayProcessed').append('')
        })
    })
    $('#csvreview_file_wordcloud').click(function(){
        data = {
            'csrfmiddlewaretoken': getCookie('csrftoken'),
            'csv_file_tobe_analysed': $('#csv_file_tobe_analysed')[0].value,
            'submit': 'csvreview_file_wordcloud'
        }
        $.post('analyse', data, function(data){
            // $('#display_csv_file_Processed').append('')
        })
    })
    $('#csvreview_file_word_frequency_bar_plt').click(function(){
        data = {
            'csrfmiddlewaretoken': getCookie('csrftoken'),
            'csv_file_tobe_analysed': $('#csv_file_tobe_analysed')[0].value,
            'submit': 'csvreview_file_word_frequency_bar_plt'
        }
        $.post('analyse', data, function(data){
            // $('#display_csv_file_Processed').append('')
        })
    })
</script>   
{% endblock %}